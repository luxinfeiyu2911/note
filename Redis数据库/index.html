<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Redis数据库 | 小🦌书屋</title>

<link rel="shortcut icon" href="https://stag1129.github.io/note//favicon.ico?v=1673423068352">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://stag1129.github.io/note//styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg" style="padding-top: 10px !important; padding-bottom: 10px !important;">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            小🦌书屋
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                            <a href="/" class="menu gt-a-link">
                                🏠首页
                            </a>
                            
                </div>
                
                <div class="nav-item">
                    
                            <a href="/archives" class="menu gt-a-link">
                                📚归档
                            </a>
                            
                </div>
                
                <div class="nav-item">
                    
                            <a href="/tags" class="menu gt-a-link">
                                🔖标签
                            </a>
                            
                </div>
                
                <div class="nav-item">
                    
                            <a href="/about" class="menu gt-a-link">
                                🪶关于
                            </a>
                            
                </div>
                
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1673423068352"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second" style="border-radius: 7px;">
            <article class="gt-post-content">
                <h2 class="post-title">
                    Redis数据库
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2022-12-28 ·
                    </time>
                    
                        <a href="https://stag1129.github.io/note/database_normal/" class="post-tags">
                            # 数据库
                        </a>
                    
                        <a href="https://stag1129.github.io/note/database_nostructure/" class="post-tags">
                            # 非结构化数据库
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>📖 内容介绍：Redis是一种NoSQL数据库<br>
数百万开发人员用作数据库、缓存、流式处理引擎和消息代理的开源内存中数据存储</p>
<!-- more -->
<h2 id="第一章-nosql相关概念">第一章 NoSQL相关概念</h2>
<h3 id="11-nosql特点及优势">1.1 NoSQL特点及优势</h3>
<blockquote>
<p>🔖 NoSQL全称是Not Only SQL，是一种非关系型数据库</p>
</blockquote>
<p>相较于传统的SQL数据库而言，NoSQL特点：</p>
<ul>
<li>不保证关系数据ACID特性 - <strong>ACID</strong>：原子性(atomicity，或称不可分割性)、 一致性 (consistency)、 隔离性 (isolation，又称独立性)、 持久性 (durabilit)</li>
<li>并不遵循SQL标准</li>
<li>消除数据之前关联特性</li>
</ul>
<p>相较于传统的SQL数据库而言，NoSQL优势：</p>
<ul>
<li>远超传统关系型数据库的性能</li>
<li>非常易于扩展</li>
<li>数据模型更加灵活</li>
<li>高可用</li>
</ul>
<h3 id="12-nosql种类">1.2 NoSQL种类</h3>
<blockquote>
<p>🔖 Redis数据库是一个开源的键值存储数据库，所有的数据全部存放在内存中，它的性能大大高于磁盘IO，并且它也可以支持数据持久化，支持横向扩展,主从复制等</p>
</blockquote>
<p>NoSQL数据库的种类:</p>
<ol>
<li>键值存储数据库: 所有数据都是通过键值方式存储的,类似于HashMap,使用起来非常简单方便,性能也非常高</li>
<li>列存储数据库: 通常用来应对分布式存储的海量数据.键仍然存在,但是它们的特点是指向了多个列</li>
<li>文档型数据库: 它是以一种特定的文档格式存储数据,比如JSON格式,在处理网页等复杂的数据时,文档型数据库比传统键值数据库的查询效率更高</li>
<li>图形数据库: 利用类似于图的数据结构存储数据,结合图相关算法高速访问</li>
</ol>
<h2 id="第二章-redis安装和部署">第二章 Redis安装和部署</h2>
<blockquote>
<p>🔗 Redis下载地址：</p>
<ol>
<li>官网地址：<a href="https://redis.io/download/">https://redis.io/download/</a></li>
<li>Windows版本：<a href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></li>
</ol>
</blockquote>
<h3 id="21-在centos下安装redis">2.1 在CentOS下安装Redis</h3>
<ol>
<li>下载Redis安装包<br>
<code>wget https://github.com/redis/redis/archive/7.0.7.tar.gz</code></li>
<li>解压Redis安装包<br>
<code>tar -zxvf 7.0.7.tar.gz</code></li>
<li>进入Reids目录并编译<br>
<code>cd ./7.0.7 &amp;&amp; make</code></li>
<li>安装Redis<br>
<code>make install</code></li>
</ol>
<h3 id="22-在windows下安装redis">2.2 在Windows下安装Redis</h3>
<ol>
<li>下载Redis安装包<br>
下载地址: <a href="https://github.com/tporadowski/redis/releases/download/v5.0.14.1/Redis-x64-5.0.14.1.zip">https://github.com/tporadowski/redis/releases/download/v5.0.14.1/Redis-x64-5.0.14.1.zip</a></li>
<li>解压Redis的ZIP包<br>
Redis-x64-5.0.14.1.zip -&gt; Redis-x64-5.0.14.1文件夹</li>
</ol>
<h3 id="23-常见问题">2.3 常见问题</h3>
<ol>
<li>提示没有安装GCC<br>
解决方法: <code>yum install gcc</code><br>
问题截图:<br>
<img src="https://stag1129.github.io/note//post-images/1673273105149.jpg" alt="需要安装GCC" loading="lazy"></li>
<li>提示没有找到目录<br>
解决办法: <code>make MALLOC=libc</code><br>
问题截图:<br>
<img src="https://stag1129.github.io/note//post-images/1673273698816.png" alt="提示没有找到目录" loading="lazy"></li>
</ol>
<h2 id="第三章-基本操作-hashmapstringstring">第三章 基本操作 (HashMap&lt;String,String&gt;)</h2>
<blockquote>
<p>🔖 Redis数据库是有一个整数索引标识.默认情况下,Redis数据库使用0号数据库,通过Redis配置文件中的参数来修改数据库总数,默认共16个</p>
</blockquote>
<ol>
<li>切换Redis数据库<br>
<code>select 数据库索引标识</code></li>
<li>添加数据<br>
添加一个数据: <code>set &lt;key&gt; &lt;value&gt;</code><br>
添加多个数据:  <code>mset [&lt;key&gt; &lt;value&gt;]...</code><br>
所有存储的数据默认会以<strong>字符串</strong>进行保存,可以通过 : 进行板块分割<br>
<code>set A:key1:key2 value</code></li>
<li>获取存入的键值<br>
<code>get &lt;key&gt;</code></li>
<li>存储数据时,设定数据过期时间,默认永久有效(-1)<br>
设置过期秒数: <code>set &lt;key&gt; &lt;value&gt; EX 秒数</code><br>
设置过期毫秒数: <code>set &lt;key&gt; &lt;value&gt; PX 毫秒</code></li>
<li>单独设定数据过期时间<br>
<code>expire &lt;key&gt; 秒数</code></li>
<li>查看某个键值对的剩余有效时间<br>
剩余有效秒数: <code>ttl &lt;key&gt;</code><br>
剩余有效毫秒数: <code>pttl &lt;key&gt;</code></li>
<li>设置某个键值对永久有效<br>
<code>persist &lt;key&gt;</code></li>
<li>删除键值对<br>
<code>del &lt;key&gt; [&lt;key&gt;]...</code></li>
<li>查看所有的键<br>
<code>keys *</code></li>
<li>查看某个键是否存在(存在返回1;不存在返回0)<br>
<code>exists &lt;key&gt;</code></li>
<li>随机取键<br>
<code>randomkey</code></li>
<li>将当前数据库的值移动到另一个数据库<br>
<code>move &lt;key&gt; 整数索引标识</code></li>
<li>修改键的名称<br>
直接修改: <code>rename &lt;key&gt; &lt;新名称&gt;</code><br>
先判断新名称,不存在时修改: <code>renamex &lt;key&gt; &lt;新名称&gt;</code></li>
<li>对值为整数类型的数据可进行自增自减操作<br>
自增1: <code>incr &lt;key&gt;</code><br>
自增n: <code>incrby &lt;key&gt; n</code><br>
自减1: <code>decr &lt;key&gt;</code></li>
<li>查看值的数据类型<br>
<code>type &lt;key&gt;</code></li>
</ol>
<h2 id="第四章-其他数据类型">第四章 其他数据类型</h2>
<h3 id="41-hash数据hashmapstringhashmapstringstring">4.1 Hash数据(HashMap&lt;String,HashMap&lt;String,String&gt;&gt;)</h3>
<ol>
<li>添加数据<br>
<code>hset &lt;key&gt; [&lt;字段&gt; &lt;值&gt;]...</code></li>
<li>获取值<br>
获取某个字段值: <code>hget &lt;key&gt; &lt;字段&gt;</code><br>
获取全部字段和值: <code>hgetall &lt;key&gt;</code></li>
<li>判断字段是否存在(存在返回1;不存在返回0)<br>
<code>hexists &lt;key&gt; &lt;字段&gt;</code></li>
<li>删除字段(删除成功为1;删除失败为0)<br>
<code>hdel &lt;key&gt; &lt;字段&gt;</code></li>
<li>获取hash中存储键值对的个数<br>
<code>hlen &lt;key&gt;</code></li>
<li>一次性获取所有的字段值<br>
<code>hvals &lt;key&gt;</code></li>
<li>一次性获取所有的字段<br>
<code>hkeys &lt;key&gt;</code></li>
</ol>
<h3 id="42-list数据linkedlist">4.2 List数据(LinkedList)</h3>
<ol>
<li>添加元素<br>
头部添加元素：<code>lpush &lt;key&gt; &lt;element&gt;...</code><br>
尾部添加元素：<code>rpush &lt;key&gt; &lt;element&gt;...</code><br>
指定位置前后添加元素：<code>linsert &lt;key&gt; before/after &lt;指定元素&gt; &lt;element&gt;</code></li>
<li>获取元素<br>
通过下表获取元素：<code>lindex &lt;key&gt; &lt;下标&gt;</code><br>
获取并移除头部元素：<code>lpop &lt;key&gt;</code><br>
获取并移除尾部元素：<code>rpop &lt;key&gt;</code><br>
获取制定范围内的元素(负数为从后往前)：<code>lrange &lt;key&gt; start stop</code><br>
获取某个键的全部元素：<code>lrange &lt;key&gt; 0 -1</code></li>
<li>从当前数组中的右侧获取一个数插入到目标数组的左侧<br>
<code>rpoplpush 当前数组 目标数组</code></li>
<li>阻塞操作,等待数据产生<br>
<code>blpop &lt;key&gt;... timeout</code></li>
</ol>
<h3 id="43-set数据hashset">4.3 Set数据(HashSet)</h3>
<ol>
<li>添加数据<br>
<code>sadd &lt;key&gt; &lt;value&gt;...</code></li>
<li>查看数据个数<br>
<code>scard &lt;key&gt;</code></li>
<li>判断集合中是否包含某个值<br>
<code>sismember &lt;key&gt; &lt;value&gt;</code></li>
<li>列出所有值<br>
<code>smembers &lt;key&gt;</code></li>
<li>集合之间的运算<br>
集合之间的差集：<code>sdiff &lt;key1&gt; &lt;key2&gt;</code><br>
集合之间的交集：<code>sinter &lt;key1&gt; &lt;key2&gt;</code><br>
集合之间并集：<code>sunion &lt;key1&gt; &lt;key2&gt;</code><br>
将集合之间的差集存到目标集合中：<code>sdiffstore 目标 &lt;key1&gt; &lt;key2&gt;</code><br>
将集合之间的交集存到目标集合中：<code>sinterstore 目标 &lt;key1&gt; &lt;key2&gt;</code><br>
将集合之间的并集存到目标集合中：<code>sunionstore 目标 &lt;key1&gt; &lt;key2&gt;</code></li>
<li>移动制定值到另一个集合中<br>
<code> smove &lt;key&gt; 目标 &lt;value&gt;</code></li>
<li>删除数据<br>
随机移除一个数据：<code>spop &lt;key&gt;</code><br>
移除指定值：<code>srem &lt;key&gt; &lt;value&gt;</code></li>
</ol>
<h3 id="44-sortedset数据">4.4 SortedSet数据</h3>
<ol>
<li>添加带分数的值<br>
<code>zadd &lt;key&gt; [&lt;score&gt; &lt;value&gt;]...</code></li>
<li>查询有多少个值<br>
<code>zcard &lt;key&gt;</code></li>
<li>移除特定的值<br>
<code>zrem &lt;key&gt; &lt;value&gt;...</code></li>
<li>获取区间内的值<br>
<code>zrange &lt;key&gt; start stop</code></li>
<li>根据值的分数来获取<br>
通过分数值查看：<code>zrangebyscore &lt;key&gt; start stop [withscores] [limit]</code><br>
统计某个分数值内的数量：<code>zcount &lt;key&gt; start stop</code><br>
根据分数获取指定排名：<code>zrank &lt;key&gt; &lt;value&gt;</code></li>
</ol>
<h3 id="45-其他数据">4.5 其他数据</h3>
<ul>
<li>Bitmap: 位图操作</li>
<li>HyperLogLong: 做基数统计</li>
<li>Geospatial: 地理空间以及索引半径查询</li>
</ul>
<p>📑 常用命令参考：<a href="https://zhuanlan.zhihu.com/p/47692277">https://zhuanlan.zhihu.com/p/47692277</a></p>
<h2 id="第五章-redis持久化">第五章 Redis持久化</h2>
<blockquote>
<p>🔖 持久化实现方式有两种方案：</p>
<ol>
<li>直接保存当前已经存储的数据,相当于复制内存中的数据到磁盘上,需要恢复数据时直接读取即可</li>
<li>保存存放数据的所有过程,只需要将整个过程完整地重演一遍就能保证与之前数据库中的内容一致</li>
</ol>
</blockquote>
<h3 id="51-rdb保存已经存储的数据">5.1 RDB（保存已经存储的数据）</h3>
<p>方式一：在Redis主进程中开启保存事物：<code>save</code><br>
方式二：单独开一个子进程后台执行保存：<code>bgsave</code><br>
执行后会产生一个dump.rdb文件,文件中的数据就保存了内存中存放的数据,当服务重启后,会自动加载里面的内容到对应的数据库中<br>
修改配置文件的配置信息：<strong>save 300 10</strong> # 300秒内有10个写入</p>
<h3 id="52-aof存放数据的所有过程信息">5.2 AOF(存放数据的所有过程信息)</h3>
<p>通过日志的形式每次执行的命令都进行保存,服务器重启时会将所有命令一次执行<br>
AOF写日志的策略：</p>
<ul>
<li><strong>always</strong>: 每次执行写操作都会保存一次</li>
<li><strong>everysec</strong>: 每秒保存一次(默认配置)</li>
<li><strong>no</strong>: 系统自定义</li>
</ul>
<p>AOF通过配置文件开启，将appendonly的no改为yes：<code>appendonly yes</code><br>
AOF配置文件调整策略：<code>appendfsync always | everysec | no</code><br>
重启服务后,可以看到服务器目录下多了一个appendonly.aof文件,存储的就是我们执行的命令<br>
手动执行重写操作：<code>bgrewriteaof</code><br>
配置文件中配置自动重写:<br>
百分比计算：<code>auto-aof-rewrite-percentage 100</code><br>
当达到这个大小时,触发自动重写：<code>auto-aof-rewrite-min-size 64mb</code></p>
<h3 id="53-rdb和aof对比">5.3 RDB和AOF对比</h3>
<p><strong>AOF</strong>:</p>
<ul>
<li><strong>优点</strong>: 存储速度快,消耗资源少、支持实时存储</li>
<li><strong>缺点</strong>: 加载数据慢、数据体积大</li>
</ul>
<p><strong>RDB</strong>:</p>
<ul>
<li><strong>优点</strong>: 加载速度快、数据体积小</li>
<li><strong>缺点</strong>: 存储速度慢,大量消耗资源、会发生数据丢失</li>
</ul>
<h2 id="第六章-事物和锁机制">第六章 事物和锁机制</h2>
<h3 id="61-事物">6.1 事物</h3>
<blockquote>
<p>🔖 保证多条命令一次性完整执行而中途不受到其他命令干扰</p>
</blockquote>
<p><strong>开启事物</strong>：<code>multi</code><br>
<strong>执行事物</strong>：<code>exec</code><br>
<strong>取消事物</strong>：<code>discard</code></p>
<h3 id="62-锁机制">6.2 锁机制</h3>
<blockquote>
<p><strong>悲观锁</strong>: 时刻认为别人回来抢占资源,禁止一切外来访问,直到释放锁,具有强烈的排他性质<br>
<strong>乐观锁</strong>: 并不认为会有其他人来抢占资源,所以会直接对数据进行操作,在操作时再去验证是否会有其他人抢占资源</p>
</blockquote>
<p>监视某个目标,如果执行事务之前被监视的目标发生了修改,则取消本次事物：<code>watch</code><br>
取消监视：<code>unwatch</code></p>
<h2 id="第七章-redis与应用程序交互">第七章 Redis与应用程序交互</h2>
<h3 id="71-在maven中调用redis">7.1 在Maven中调用Redis</h3>
<ol>
<li>pom文件中引入Redis依赖<pre><code class="language-java">&lt;!--Jedis - Redis的依赖库--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;redis.clients&lt;/groupId&gt;
    &lt;artifactId&gt;jedis&lt;/artifactId&gt;
    &lt;version&gt;4.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;!--slf4j - 解决Jedis运行时提示的问题org.slf4j.impl.StaticLoggerBinder--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-jdk14&lt;/artifactId&gt;
    &lt;version&gt;1.7.32&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>测试是否连接成功<pre><code class="language-java">public static void main(String[] args) {
    Jedis jedis = new Jedis(&quot;localhost&quot;, 6379);
    jedis.close();
}
</code></pre>
</li>
<li>举例1：通过jedis设置并查询普通键值对(HashMap&lt;String,String&gt;)<pre><code class="language-java">public static void main(String[] args) {
    try (Jedis jedis = new Jedis(&quot;localhost&quot;, 6379)) {
        jedis.set(&quot;a&quot;, &quot;123&quot;);
        System.out.println(jedis.get(&quot;a&quot;));
    }
}
</code></pre>
</li>
<li>举例2：通过jedis设置并查询Hash数据(HashMap&lt;String,HashMap&lt;String,String&gt;&gt;)<pre><code class="language-java">public static void main(String[] args) {
    try (Jedis jedis = new Jedis(&quot;localhost&quot;, 6379)) {
        jedis.hset(&quot;b&quot;, &quot;name&quot;, &quot;张三&quot;);
        Map&lt;String, String&gt; temp = new HashMap&lt;&gt;();
        temp.put(&quot;age&quot;, &quot;19&quot;);
        jedis.hset(&quot;b&quot;, temp);
        jedis.hgetAll(&quot;b&quot;).forEach((key, value) -&gt; {
            System.out.println(key + &quot; : &quot; + value);
        });
    }
}
</code></pre>
</li>
<li>举例3：通过jedis设置并查询List数据(LinkedLIst)<pre><code class="language-java">public static void main(String[] args) {
    try (Jedis jedis = new Jedis(&quot;localhost&quot;, 6379)) {
        jedis.lpush(&quot;c&quot;, &quot;123&quot;, &quot;456&quot;, &quot;789&quot;);
        jedis.lrange(&quot;c&quot;, 0, -1).forEach(System.out::println);
    }
}
</code></pre>
</li>
<li>举例4：通过jedis设置并查询Set数据(HashSet)<pre><code class="language-java">public static void main(String[] args) {
    try (Jedis jedis = new Jedis(&quot;localhost&quot;, 6379)) {
        jedis.sadd(&quot;d&quot;, &quot;123&quot;, &quot;123&quot;, &quot;456&quot;, &quot;789&quot;);
        jedis.smembers(&quot;d&quot;).forEach(System.out::println);
    }
}
</code></pre>
</li>
<li>举例5：通过jedis设置并查询SortedSet数据<pre><code class="language-java">public static void main(String[] args) {
    try (Jedis jedis = new Jedis(&quot;localhost&quot;, 6379)) {
        jedis.zadd(&quot;e&quot;, 5, &quot;abc&quot;);
        jedis.zadd(&quot;e&quot;, 10, &quot;def&quot;);
        jedis.zadd(&quot;e&quot;, 2, &quot;hij&quot;);
        jedis.zrange(&quot;e&quot;, 0, -1).forEach(System.out::println);
    }
}
</code></pre>
</li>
</ol>
<h3 id="72-在springboot中调用redis">7.2 在SpringBoot中调用Redis</h3>
<ol>
<li>创建SpringBoot勾选Lombok和Redis相关依赖<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>在application.yml中配置redis相关信息<pre><code class="language-java">spring:
    redis:
        host: localhost
        port: 6379
        database: 0
</code></pre>
</li>
<li>SpringBoot自动创建Redis两种模板Bean(RedisAutoConfiguration.java)<pre><code class="language-java">@Bean
@ConditionalOnMissingBean(
    name = {&quot;redisTemplate&quot;}
)
@ConditionalOnSingleCandidate(RedisConnectionFactory.class)
public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) {
RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate();
    template.setConnectionFactory(redisConnectionFactory);
    return template;
}

@Bean
@ConditionalOnMissingBean
@ConditionalOnSingleCandidate(RedisConnectionFactory.class)
public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) {
    return new StringRedisTemplate(redisConnectionFactory);
}
</code></pre>
</li>
<li>举例1：通过StringRedisTemplate设置并查询普通键值对(HashMap&lt;String,String&gt;)<pre><code class="language-java">@Autowired
private StringRedisTemplate template;

@Test
void test1() {
    template.opsForValue().set(&quot;a&quot;, &quot;lisi&quot;);
    System.out.println(template.opsForValue().get(&quot;a&quot;));
}
</code></pre>
</li>
<li>举例2：通过StringRedisTemplate删除并判断是否存在普通键值对(HashMap&lt;String,String&gt;)<pre><code class="language-java">template.delete(&quot;a&quot;);
template.hasKey(&quot;a&quot;);
</code></pre>
</li>
</ol>
<h3 id="73-在springboot中redis事物管理器">7.3 在SpringBoot中Redis事物管理器</h3>
<blockquote>
<p>🔖 Spring没有专门的Redis事物管理器，所以只能借助于JDBC提供的</p>
</blockquote>
<ol>
<li>在pom文件中引入JDBC依赖<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;8.0.21&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>在application.yml中配置MySQL数据库信息<pre><code class="language-java">spring:
    datasource:
        url: jdbc:mysql://localhost:3306/demo?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;rewriteBatchedStatements=true
        driver-class-name: com.mysql.cj.jdbc.Driver
        username: root
        password: 
</code></pre>
</li>
<li>创建RedisService,并开启Redis事物<pre><code class="language-java">@Service
public class RedisService {
    @Autowired
    private StringRedisTemplate template;

    @PostConstruct
    public void init() {
        template.setEnableTransactionSupport(true);
    }

    @Transactional
    public void test() {
        template.multi();
        template.opsForValue().set(&quot;a&quot;, &quot;wangwu&quot;);
        template.exec();
    }
}
</code></pre>
</li>
<li>调用RedisService的test方法<pre><code class="language-java">@Autowired
RedisService redisService;

@Test
void test1() {
    redisService.test();
}
</code></pre>
</li>
</ol>
<h3 id="74-在springboot中redis序列化">7.4 在SpringBoot中Redis序列化</h3>
<p><strong>JDK自带的序列化器</strong></p>
<ol>
<li>创建Demo实体类<pre><code class="language-java">@Data
@AllArgsConstructor
@NoArgsConstructor
public class Demo implements Serializable {
    String id;
    String name;
}
</code></pre>
</li>
<li>通过RedisTemplate调用<pre><code class="language-java">@Autowired
private RedisTemplate&lt;Object, Object&gt; template;

@Test
void test1() {
    StringRedisSerializer StringRedisSerializer=new StringRedisSerializer();
    template.setKeySerializer(StringRedisSerializer);
    Demo demo = new Demo(&quot;1&quot;, &quot;zhangsan&quot;);
    template.opsForValue().set(&quot;e&quot;, demo);
}
</code></pre>
</li>
</ol>
<p><strong>Jackson序列化器</strong></p>
<ol>
<li>
<p>创建Demo实体类</p>
<pre><code class="language-java">@Data
@AllArgsConstructor
@NoArgsConstructor
public class Demo {
    String id;
    String name;
}
</code></pre>
</li>
<li>
<p>在pom文件中引入jackson-databind依赖</p>
<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>通过RedisTemplate调用</p>
<pre><code class="language-java">@Autowired
private RedisTemplate&lt;Object, Object&gt; template;

@Test
void test1() {
    StringRedisSerializer StringRedisSerializer=new StringRedisSerializer();
    template.setKeySerializer(StringRedisSerializer);
    template.setValueSerializer(new Jackson2JsonRedisSerializer&lt;Object&gt;(Object.class));
    Demo demo = new Demo(&quot;1&quot;, &quot;zhangsan&quot;);
    template.opsForValue().set(&quot;e&quot;, demo);
}
</code></pre>
</li>
</ol>

                </div>
            </article>
        </div>

        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first"></div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        <div>
        <span>欢迎来到🦌的小书屋</span>&nbsp;&nbsp;
    </div>
    <div>
        搭建距今:&nbsp;&nbsp;<span id="time" style="background-image: linear-gradient(to right, #1D976C, #93F9B9); -webkit-background-clip: text; color:
        transparent;"></span>
    </div>
    <div>
        一个<span
            style="background-image: linear-gradient(to right, #6DD5FA, #2980B9); -webkit-background-clip: text; color: transparent;">正在奋斗</span>、<span
            style="background-image: linear-gradient(to right,  #009FFF, #ec2F4B); -webkit-background-clip: text; color: transparent;">不断求学</span>、<span
            style="background-image: linear-gradient(to right, #f12711, #f5af19); -webkit-background-clip: text; color: transparent;">追求新知</span>、<span
            style="background-image: linear-gradient(to right, #FDC830, #F37335); -webkit-background-clip: text; color: transparent;">努力创新</span>的有志青年
    </div>

    <script>
        Date.prototype.format = function (format) {
            var o = {
                "M+": this.getMonth() + 1, //month
                "d+": this.getDate(), //day
                "h+": this.getHours(), //hour
                "m+": this.getMinutes(), //minute
                "s+": this.getSeconds(), //second
                "q+": Math.floor((this.getMonth() + 3) / 3), //quarter
                "S": this.getMilliseconds() //millisecond
            }
            if (/(y+)/.test(format)) format = format.replace(RegExp.$1,
                (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o) if (new RegExp("(" + k + ")").test(format))
                format = format.replace(RegExp.$1,
                    RegExp.$1.length == 1 ? o[k] :
                        ("00" + o[k]).substr(("" + o[k]).length));
            return format;
        }
        //其中starttime格式为20180101010101
        function getDiffTwoTime(startTime, endTime) {
            if (startTime.length < 14 || endTime.length < 14) {
                alert('时间格式不正确');
            }
            var startArr = [startTime.substring(0, 4), startTime.substring(4, 6), startTime.substring(6, 8), startTime.substring(8, 10), startTime.substring(10, 12), startTime.substring(12, 14)];//切分开始时间为数组
            var endArr = [endTime.substring(0, 4), endTime.substring(4, 6), endTime.substring(6, 8), endTime.substring(8, 10), endTime.substring(10, 12), endTime.substring(12, 14)];//切分结束时间为数组
            var dateStart = new Date(startArr[0], startArr[1], startArr[2], startArr[3], startArr[4], startArr[5]);//采用new Date(yyyy,mth,dd,hh,mm,ss);创建方式分别传入年月日时分秒
            var dateEnd = new Date(endArr[0], endArr[1], endArr[2], endArr[3], endArr[4], endArr[5]);
            var dateInterval = dateEnd.getTime() - dateStart.getTime() //获取时间差毫秒
            //计算出相差天数
            var days = Math.floor(dateInterval / (24 * 60 * 60 * 1000));
            //计算小时数
            var hourLevel = dateInterval % (24 * 60 * 60 * 1000);
            var hours = Math.floor(hourLevel / (60 * 60 * 1000))
            //计算分钟数
            var minutesLevel = hourLevel % (60 * 60 * 1000);
            var minutes = Math.floor(minutesLevel / (60 * 1000));
            //计算秒数
            var seconds = Math.round((minutesLevel % (60 * 1000)) / 1000);
            return days + ' 天 ' + hours + ' 时 ' + minutes + ' 分 ' + seconds + ' 秒 '
        }
        //填充时间
        function fillintime() {
            let startTime = new Date("2023-01-07 22:30:00").format('yyyyMMddhhmmss');
            let currentTime = new Date().format('yyyyMMddhhmmss');
            document.getElementById('time').innerHTML = getDiffTwoTime(startTime, currentTime)
        }
        //定期执行
        let ref = setInterval(function () {
            fillintime();
            // clearInterval(ref); //取消执行
        }, 1000);
    </script>
    </div>
    <div style="display: none;">
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://stag1129.github.io/note//atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
